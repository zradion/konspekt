<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/style1.css" />
  <title>Django</title>
</head>

<body>
  <div class="cont">
    <nav class="menu">
      <ul class="menu_list">
        <li><a href="../index.html"><img src="../img/icon-home.png" alt="home"></a></li>
        <li>
          <span>Python</span>
          <ul class="sub_menu_list">
            <li><a href="./startPy.html">startPy</a></li>
            <li><a href="./libraryPy.html">libraryPy</a></li>
            <li><a href="./dir_and_file.html">Папки и файлы</a></li>
            <li><a href="./pictures.html">Картинки и графики</a></li>
            <li><a href="./web_scraping.html">Web scraping</a></li>
            <li><a href="./flask.html">Flask</a></li>
            <li><a href="./django.html">Django</a></li>
            <li>Искуственный интелект
              <ul>
                <li><a href="./gym.html">Gym</a></li>
                <li><a href="./ml.html">ML</a></li>
                <li><a href="./nlp.html">NLP</a></li>
              </ul>
          </ul>
        </li>
        <li>
          <span>Frontend</span>
          <ul class="sub_menu_list">
            <li><a href="../frontend/html.html">HTML</a></li>
            <li><a href="../frontend/css.html">CSS</a></li>
            <li><a href="../frontend/js.html">JavaScript</a></li>
            <li><a href="../frontend/jsDom.html">JavaScript DOM</a></li>
          </ul>
        </li>
        <li>
          <span>Books</span>
          <ul class="sub_menu_list">
            <li><a href="../books/english.html">Books in English</a></li>
            <li><a href="../books/math.html">Математика</a></li>
            <li><a href="../books/environment.html">Окружение</a></li>
            <li><a href="../books/digest.html">Справочники</a></li>
          </ul>
        </li>
      </ul>
    </nav>
    <div class="left_right">
      <aside class="left">
        <p><a href="#s1">Проект</a></p>
        <p><a href="#s2">Ядро</a></p>
        <p><a href="#s3">Обработчик</a></p>
        <p><a href="#s4">GET & POST</a></p>
        <p><a href="#s5">Шаблоны, render</a></p>
      </aside>

      <aside class="right">
<p><a href="https://django.fun/docs/django/5.0/" target="_blank" rel="noopener" >Django документация</a><br>
<a href="https://www.youtube.com/watch?v=FyTL1bnUx5I&list=PLA0M1Bcd0w8xO_39zZll2u1lz_Q-Mwn1F&index=1" target="_blank" rel="noopener" >Django (selfedu)</a></p>

  <section id="s1"> <h3>Создаём проект; запускаем сервер</h3>
<b>WSGI</b>(Web Server Gateway Interface) - стандарт взаимодействия между Python-программой, выполняющейся на стороне сервера и самим веб-сервером.<br>
localhost - 127.0.0.1 локальная сеть компа и её обычный ip адрес; пакет Django содержит отладочный веб сервер.<br>
<i>хостинги</i> - размещаются на арендуемых серверах<br>
открыть терминал;<br>
Снимаем защиту на изменение сценариев в PowerShell<br>
<i>Get-ExecutionPolicy</i> - проверить разрешены ли сценарии выполнения<br>
<i>Set-ExecutionPolicy RemoteSigned</i> - запустить в PowerShell от админа, чтобы установить виртуальную среду; выбрать А (для всех) (unrestricted)<br>
<i>Set-ExecutionPolicy Default</i> - вернуть запрет на использование виртуальной среды<br><br>

В созданной папке создаём виртуальное окружение и активизируем<br>
<i>python -m venv venv</i> - создать папку виртуального окружения<br>
<i>./venv/Scripts/activate</i> - активировать<br>
(<i>source venv/bin/activate</i> - для Linux)<br>
<i>deactivate</i> - деактивировать<br>
<i>pip install django</i><br>
<i>python -m django --version</i> - версия django<br>
<i>pip list</i> - список установленых модулей<br>
<i>django-admin</i> - список команд ядра django<br><br>

<b>создание проекта <i>sitewomen.ru</i></b><br>
<i>django-admin startproject sitewomen</i> - создаём папку проекта; в ней автоматом создатся папка с таким же названием (пакет конфигурации: __init__.py, asgi.py, settings.py, urls.py, wsgi.py) и утилита manage.py<br>
<i>cd sitewomen</i> - переходим в эту папку<br>
<i>python manage.py runserver</i> - запуск сервера<br>
<i>Ctrl-Break (Ctrl+C)</i> - остановить сервер (при необходимости перезапустить)<br>
при запуске в папке появляется файл db.sqlite3; при необходимости можно изменить СУБД (PostgreSQL, MariaDB, MySQL, Oracle, SQLite)
  </section>

  <section id="s2"> <h3>Создать и зарегистрировать приложение (ядро сайта)</h3>
<i>MTV</i> - (Models, Templates, Views) представление на основе шаблонов и данных<br>

В терминале открываем новую вкладку (пришлось заново активировать env); переходим в каталог нашего проекта;<br>
<i>python manage.py startapp women</i> - в проекте появилась папка women - новое прилолжение; в ней:<br>
<i>__init__.py</i> - это приложение - пакет<br>
<i>migrations</i> - папка для хранения миграций баз данных<br>
<i>admin.py</i> - связь с админ панелью сайта<br>
<i>apps.py</i> - настройки<br>
<i>model.py</i> - орм модели<br>
<i>tests.py</i> - для тестирования<br>
<i>views.py</i> - хранение представлений<br>
<i>urls.py</i> - (создаём сами) для новых путей в приложении<br>
<i>tamplates</i> - (создаём сами, в ней папка с названием прилож) для шаблонов 'html'<br>
<i>db.sqlite3</i><br><br>

зарегистрировать приложение в проекте сайта:<br>
в файлe конфигурации; открыть <i>settings.py</i>; добавить в список <i>INSTALLED_APPS</i> название приложения (<i>women</i>) или <i>women.apps.WomenConfig</i> так как django будет искать это прилолжение в настройках (<i>apps.py</i>), а там создан <i>class WomenConfig(AppConfig)</i>
  </section>

  <section id="s3"> <h3>Обработчик главной страницы сайта</h3>
Представление реализуется или в виде ф-ций или в виде классов; располагаются во <i>views.py</i><br>
<i>from django.http import HttpResponse</i> - для того, чтобы ф-ция возвращала экземпляр класса HttpResponse<br>
<i>def index(request):</i> #HttpRequest - класс с инфо о запросе, сесии, куках..<br>
&nbsp;&nbsp;&nbsp;&nbsp;return HttpResponse("Страница приложения women")<br><br>

Теперь связать эту ф-цию с соответсвующим url адресом.<br>
В пакете конфигурации открыть <i>url.py</i>;<br>
<i>from sitewomen.women.views import *</i> импортируем всё из <i>sitewomen.women.views</i><br>
и в список путей <i>urlpatterns</i> (в нём уже есть путь до админки) добавляем ещё один маршрут:<br>
<i>path('', index)</i> - ф-ция <i>path</i>; шаблон (будет добавлятся к домену сайта) и ссылка на ф-цию <i>index</i>, которую мы создали во <i>views.py</i><br>
если после этого выходит ошибка, то надо <i>sitewomen</i> сделать рабочей папкой (правой кнопкой; <i>Mark Directory as</i>; <i>Sources Root</i>)<br><br>

предпочтительный вариант - в пакете конфиг., urls.py указывать список всех путей. Для этого импортируем<br>
<i>from django.urls import path, include</i><br>
и в urlpatterns добавляем:<br>
<i>path('', include('women.urls')),</i> - доменное имя теперь - стартовая страница; все остальные пути прописаны в 'women.urls'<br><br>

создаём в <i>women</i> файл <i>urls.py</i>; импоритируем:<br>
<i>from django.urls imort path, re_path</i><br>
<i>from . import views</i><br>
и прописываем все пути:<br>
urlpatterns = [<br>
path('', views.index), - главная страница без префикса <i>women</i> <br>
path('cats/', views.categories)] - добавили новый путь (создано представление <i>categories</i> во <i>views.py</i> ) (#http://127.0.0.1:8000/cats/)<br><br>

маршрут может быть дополнен с помощью конвертора; например:<br>
<i>path('cats/&lt;int:cat_id>/', categories)</i>; добавить в ф-цию представления второй аргумент <i>cat_id</i> - теперь полный маршрут <i>cats/произвольное число</i> <br>
ещё в качестве расширения может быть:<br>
<i>str</i> - не пустая строка, исключая '/'<br>
<i>slug</i> - латиница, дефис, подчёркивание<br>
<i>uuid</i> - цифры, малые латинские символы, дефис<br>
<i>path</i> - любая строка, включая '/'<br><br>

re_path() - для использования регулярного выражения; импортируем соотв. модуль (from django.urls import re_path); добавляем в women/urls.py ещё один путь:<br>
<i>re_path(r'^archive/(?P<year>[0-9]{4})/', archive)</i> (именованная скобка)<br>
во вкладке <i>views.py</i> добавляем ф-цию представления:<br>
<i>def archive(request, year):</i> year - именованый параметр в рег.выр<br>
&nbsp;&nbsp;&nbsp;&nbsp;return HttpResponse(f"&lt;h1>Архив по годам&lt;/h1>&lt;p>{year}&lt;/p>")<br><br>

Для создания своего конвертора надо в приложении создать файл (converters.py) и записать туда класс в котором содержится рег.выр и ф-ции для работы с ним (например FourDigitYearConverter); в women/urls.py добавляем импорт (from . import convertors); регистрируем конвертор с помощью ф-ции <i>register_converter(converters.FourDigitYearConverter, 'year4')</i> - обращается к классу и название конвертора; эту ф-цию импортируем из django.urls; далее в <i>'urlpatterns'</i> прописываем <i>'path'</i>, где будет название конвертора и переменная.
  </section>

  <section id="s4"><h3>Обработка GET и POST запросов</h3>
<i>http://127.0.0.1:8000/?name=Gagarina&cat=music</i> - GET запрос; после адреса '?'; ключ=значение; разделитель &(амперсанд)<br><br>

В ф-ции представления указан аргумент 'request'; в этой ф-ции можно сделать запрос <i>request.GET</i> или <i>request.POST</i><br>
<i>if request.GET:</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;<i>print(request.GET)</i> -  в терминале увидим словарь<br><br>

Для отображения ненайденой страницы; в пакете конфиг settings.py изменить DEBUG = False; добавить в ALLOWED_HOSTS = ['127.0.0.1']; в urls.py добавляем обработчик для страницы 404 - переменную и ссылку на ф-цию<br>
<i>handler404 = pageNotFound</i> (handler500 - ошибка сервера, 403 - доступ запрещён, 400 - невозможно обработать запрос)<br>
ф-цию добавим во views.py; from django.http import HttpResponseNotFound<br>
<i>def pageNotFound(request, exception):</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;return HttpResponseNotFound("&lt;h1>Страница не найдена &lt;/h1>")<br><br>

В любой другой ф-ции можно вызвать исключение <i>raise Http404()</i> (надо импортировать из django.http Http404), чтобы вызвать перенаправление на ф-цию pageNotFound<br><br>

<b>redirect, reverse</b><br>
<i>django.shortcuts.redirect</i><br>
Создание перенаправлений. 301 - страница перемещена на другой постоянный адрес; 302 - перемещена временно на другой адрес; для этого используется ф-ция <i>django.shortcuts.redirect</i> (from django.shortcuts import redirect); добавляем в ф-цию представления <i>return redirect('home', permanent=True)</i>; первый аргумент - адрес или имя (добавили во views.py в 'path' главная страница name='home'), второй - постоянный или временный адрес
  </section>

  <section id="s5"><h3>шаблоны(tamplates), render to string()</h3>
(#12)<br>
<i>MTV</i> - Models, Templates, Views<br>
<i>DRY</i> - don't repeat yourself<br>
<i>DTL</i> - Django Tamlates Language, Jinja2<br>
В приложении создаём папку 'tamplates'; в ней папку с названием приложения; в ней шабллоны (index.html,..). Этот путь к файлам django находит по умолчанию; другие надо прописывать в настройках, шаблоны, DIR<br><br>

&lt;views.py><br>
<i>from django.templates.loader import render_to_string</i><br>
def index(request):<br>
&nbsp;&nbsp;&nbsp;&nbsp;t = render_to_string('women/index.html')<br>
&nbsp;&nbsp;&nbsp;&nbsp;return HttpResponse(t)<br><br>

или<br>
data={'title': 'Main page'}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return render(request, 'women.index.html', context=data)<br><br>

Доступ к словарю, списку с помощью точечной нотации.<br>
Фильтры:<br>
<i>{{ title|capfirst}}</i> - первая буква заглавная<br>
<i>add</i> (оба знач к целочисленному и сложить);<br>
<i>upper, lower, cut</i> (удалять указанные фрагменты) можно вызывать несколько<br>
<i>{{ menu|join:' | '}}</i> - разделить элементы меню<br>
<i>{{ title|default:"без заголовка" }}</i> - если title не указан<br>
<i>linebreaks|truncatewords:40</i> - предложения с новой строки, ограничить до 40 слов и ...<br>
<i>{% autoescape %} {% endautoescape}</i> - внутри этого тега теги не экранируются.<br><br>
фильтры можно получать в виде ф-ции; импортировать <i>from django.template.defaultfilters import upper</i> - (например)<br><br>

<i>&lt;ul></i><br>
<i>{% for athlete in athlete_list %}</i><br>
&nbsp;&nbsp;&nbsp;&nbsp;<i>&lt;li>{{ athlete.name }}&lt;/li></i><br>
<i>{% if not forloop.last %}</i>&lt;hr>{% endif %} - линия между 'li', кроме последней<br>
<i>{% endfor %}</i><br>
<i>&lt;/ul></i><br><br>

<i>{% url url_name arg1=v1 arg2=v2 %}</i> - (имя задаётся в urls.py)<br><br>

Для создания базового шаблона создаём папку 'templates' в корневом каталоге; в ней файл 'base.html'; в 'settings.py, переменная 'TEMPLATES', в ней 'DIR' = [BASE_DIR / 'templates']<br>
Базовый шаблон начинается с <i>{% load static %};</i><br>
дальше &lt;!DOCTYPE html>; в head подключаем стаические файлы<br>
<i>&lt;link type="text/css" href="{% static 'women/css/styles.css' %}" rel="stylesheet" /></i> (все переменные работают)<br>
что надо скопировать и тег 'block' с пороизвольным названием:<br>
<i>{% block content %} {% endblock %}</i><br><br>

В шаблоне, где будет скопирован базовый<br>
<i>{% extends 'base.html' %}</i><br>
<i>{% block content %}</i><br>
    контент дополнительно к базовому<br>
<i>{% endblock %}</i><br><br>

<i>{% include 'women/includes/nav.html %}</i> - для доп включений создаём каталог 'includes' в папке приложения, в папке 'templates', в папке 'women'; в ней файл html; в этом файле то, что будет добавлено вместо этого тега. <br>
Вторым аргументом 'only' устанавливаем - не испольовать переменные, заданные для страницы<br>
Или 'only with title2="Title2"' - задать другие переменные<br><br>

(#15)<br>
<b>Статические файлы</b><br>
В режиме отладки папка 'static' ищется в приложениях.<br>
<i>'women/static/women/css(img, js)/css.css'</i><br>
В режиме эксплуатации - в корневом каталоге. Команда <i>'python manage.py collectstatic'</i> соберёт все папки 'static' в одном месте<br>
В пакете конфигурации необходимо определить три константы:<br>
<i>STATIC_URL</i> - префикс url-адреса.( = 'static/')<br>
<i>STATIC_ROOT</i> - путь к общей статической папке.<br>
<i>STATICFILES_DIRS</i> - список дополнительных (нестандартных) путей к статическим файлам.<br><br>

<b>migrate</b><br>
/settings.py; INSTALLED_APPS содержит приложения для большинства базовых задач; для них необходимо создать таблицы (если приложение не пригодится - закоментировать или удалить); для этого в терминале<br>
<i>python manage.py migrate</i><br><br>


  </section>
      </aside>
    </div>

    </div>
  </div>
    
</body>
</html>
